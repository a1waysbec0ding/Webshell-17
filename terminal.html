<html>
<head>
    <script src='jslib/jquery-1.10.2.js'         type='text/javascript'> </script>
    <script src='jslib/jquery.terminal-0.7.6.js' type='text/javascript'> </script>
    <script src='jslib/jquery.jsonrpcclient.js' type='text/javascript'> </script>
    <script src='hamsta_command.js'      type='text/javascript'> </script>
    <link href="css/jquery.terminal.css" rel="stylesheet"/>
    <script  type='text/javascript'>
    $(document).ready(function(){
        var prompts = ['hamsta'] 
        $('#term_demo').terminal(
          function(command, term) {
	        //term.echo('Command is:' + command + "-end");
                //trim whitespace 
                //command = $.trim(command);
	        //term.echo('trimed Command is:' + command + "+end");
                if (command !== '') {
                  if (command == 'help') {
                      term.echo(term.version());
                      term.echo(term.signature());
                      term.echo(term.cols());
                      var test = new $.jsonRpcClient({ ajaxUrl: '/webshell/rpc_handler.php'});
                  }
                  else if (command == 'machine') {
                      prompts.push('machine');
                      term.push(function(cmd, term){
                          if (cmd == 'list')
                          {
                              term.echo('list all elements');
                          }
                      },{
                          prompt: window.location.hostname+':' + get_prompt_string(prompts)
                      });
                  }
                  else {
                      try {
                        var result = window.eval(command);
                        if (result !== undefined) {
                            term.echo(new String(result));
                        }
                      } catch(e) {
                        term.error(new String(e));
                      }
                  }
                } else {
                    term.echo('');
                }
                }, 
                ///term instance
                {
                       greetings: 'Hamsta web shell, enjoy it!',
                       name: 'hamsta_shell',
                       height: 500,
                       //prompt: window.location.hostname+':/hamsta> '});
                       prompt: window.location.hostname+':' + get_prompt_string(prompts)});
    });

    function get_prompt_string( prompts )
    {
        var prompt_str = "/";
        if (prompts && prompts.length>0)
        {
            $.each( prompts, function(index, value){
                prompt_str += value + "/";
            });
        }
        prompt_str += ">"
        return prompt_str;
    }
    </script>
</head>
    <body>
        <div id='term_demo'></div>
    </body>
</html>
